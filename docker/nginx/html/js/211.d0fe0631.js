"use strict";(self["webpackChunkvue"]=self["webpackChunkvue"]||[]).push([[211],{211:function(e,a,t){t.r(a),t.d(a,{default:function(){return F}});var s=t(6252),l=t(9963),i=t(3577);const n=e=>((0,s.dD)("data-v-798f8e2a"),e=e(),(0,s.Cn)(),e),o={class:"wrapper"},d={class:"content-page"},c={class:"content"},r={class:"container-fluid"},h=(0,s.uE)('<div class="row" data-v-798f8e2a><div class="col-12" data-v-798f8e2a><div class="page-title-box" data-v-798f8e2a><div class="page-title-right" data-v-798f8e2a><ol class="breadcrumb m-0" data-v-798f8e2a></ol></div><h4 class="page-title" data-v-798f8e2a>消息</h4></div></div></div>',1),u={class:"row"},g={class:"col-12"},m={class:"card"},p={class:"card-body"},y={class:"row mb-2"},w={style:{"margin-bottom":"10px"}},f={style:{"margin-top":"0!important",display:"inline-block","justify-content":"center","align-items":"center"}},T=n((()=>(0,s._)("label",{class:"form-label",style:{display:"block"}},"选择老师",-1))),b=n((()=>(0,s._)("label",{class:"form-label",style:{display:"block"}},"发送内容",-1))),Z={class:"dialog-footer"},v=n((()=>(0,s._)("label",{class:"form-label"},"输入待发送的消息",-1))),k={class:"dialog-footer"},x={id:"menu",class:"menuDiv"},C={class:"menuUl"},I=["onClick"],_={class:"changeBackgrounColor",style:{color:"rgb(109, 128, 116)",height:"35px","line-height":"35px","margin-left":"10px"}},S={style:{float:"right"}},W={style:{float:"right"}};function V(e,a,t,n,V,z){const L=(0,s.up)("TopNav"),M=(0,s.up)("LeftNav"),B=(0,s.up)("el-button"),U=(0,s.up)("el-option"),D=(0,s.up)("el-select"),R=(0,s.up)("el-input"),P=(0,s.up)("el-dialog"),F=(0,s.up)("el-table-column"),N=(0,s.up)("el-table"),j=(0,s.up)("el-dropdown-item"),E=(0,s.up)("el-dropdown-menu"),A=(0,s.up)("el-dropdown"),q=(0,s.up)("el-pagination"),$=(0,s.Q2)("loading");return(0,s.wg)(),(0,s.iD)("body",null,[(0,s._)("div",o,[(0,s.Wm)(L),(0,s.Wm)(M),(0,s._)("div",d,[(0,s._)("div",c,[(0,s._)("div",r,[h,(0,s._)("div",u,[(0,s._)("div",g,[(0,s._)("div",m,[(0,s._)("div",p,[(0,s._)("div",y,[(0,s._)("div",w,[(0,s._)("span",f,[(0,s.Wm)(B,{size:"normal",type:"success",onClick:a[0]||(a[0]=e=>z.getInitMessages(1,this.pageSize))},{default:(0,s.w5)((()=>[(0,s.Uk)("学生信息")])),_:1}),(0,s.wy)((0,s.Wm)(B,{size:"normal",type:"success",onClick:a[1]||(a[1]=e=>z.getSystemMessages(1,this.pageSize))},{default:(0,s.w5)((()=>[(0,s.Uk)("系统信息")])),_:1},512),[[l.F8,1===V.userInfo.type]]),(0,s.wy)((0,s.Wm)(B,{size:"normal",type:"success",onClick:a[2]||(a[2]=e=>V.sendToTeacherInfo.sendToTeacherVisible=!0)},{default:(0,s.w5)((()=>[(0,s.Uk)("发给老师")])),_:1},512),[[l.F8,0===V.userInfo.type]]),(0,s.Wm)(P,{modelValue:V.sendToTeacherInfo.sendToTeacherVisible,"onUpdate:modelValue":a[7]||(a[7]=e=>V.sendToTeacherInfo.sendToTeacherVisible=e),title:"消息发送",width:"30%","before-close":e.handleClose},{footer:(0,s.w5)((()=>[(0,s._)("span",Z,[(0,s.Wm)(B,{onClick:a[5]||(a[5]=e=>V.sendToTeacherInfo.sendToTeacherVisible=!1)},{default:(0,s.w5)((()=>[(0,s.Uk)("取消")])),_:1}),(0,s.Wm)(B,{type:"primary",onClick:a[6]||(a[6]=e=>z.sendMessageToTeacher(V.sendToTeacherInfo.sendToTeacherVisible=!1))},{default:(0,s.w5)((()=>[(0,s.Uk)(" 确认发送 ")])),_:1})])])),default:(0,s.w5)((()=>[T,(0,s.Wm)(D,{clearable:"",modelValue:V.sendToTeacherInfo.teacherSelectIndex,"onUpdate:modelValue":a[3]||(a[3]=e=>V.sendToTeacherInfo.teacherSelectIndex=e),class:"m-2",placeholder:"选择老师",style:{"margin-bottom":"0!important","margin-top":"0!important","margin-left":"0!important",display:"inline-block"}},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(V.sendToTeacherInfo.teacherList,(e=>((0,s.wg)(),(0,s.j4)(U,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),b,(0,s.Wm)(R,{modelValue:V.sendToTeacherInfo.sendText,"onUpdate:modelValue":a[4]||(a[4]=e=>V.sendToTeacherInfo.sendText=e),placeholder:"待发送的消息"},null,8,["modelValue"])])),_:1},8,["modelValue","before-close"])])]),(0,s.wy)(((0,s.wg)(),(0,s.j4)(N,{fit:"",stripe:"true",id:"table_studentList",hight:"","highlight-current-row":"",border:"",ref:"multipleTableRef",onRowClick:z.clickTabRow,onRowContextmenu:z.rightClick,data:V.messagesTableList,style:{width:"100%"},onSelectionChange:z.handleSelectionChange},{default:(0,s.w5)((()=>[(0,s.Wm)(F,{type:"selection",width:"55"}),(0,s.Wm)(F,{property:"status",label:"状态",width:"60px","show-overflow-tooltip":""}),(0,s.Wm)(F,{property:"sendFrom",label:"发送者",width:"150px","show-overflow-tooltip":""}),(0,s.Wm)(F,{property:"content",label:"内容","show-overflow-tooltip":""})])),_:1},8,["onRowClick","onRowContextmenu","data","onSelectionChange"])),[[$,e.tableLoading]]),(0,s.Wm)(P,{modelValue:V.deliMessageVisible,"onUpdate:modelValue":a[11]||(a[11]=e=>V.deliMessageVisible=e),title:"消息发送",width:"30%","before-close":e.handleClose},{footer:(0,s.w5)((()=>[(0,s._)("span",k,[(0,s.Wm)(B,{onClick:a[9]||(a[9]=e=>V.deliMessageVisible=!1)},{default:(0,s.w5)((()=>[(0,s.Uk)("取消")])),_:1}),(0,s.Wm)(B,{type:"primary",onClick:a[10]||(a[10]=e=>z.deliMessageConfirm(V.deliMessageVisible=!1))},{default:(0,s.w5)((()=>[(0,s.Uk)(" 确认发送 ")])),_:1})])])),default:(0,s.w5)((()=>[(0,s._)("div",null,[v,(0,s.Wm)(R,{style:{"margin-bottom":"10px"},modelValue:V.deliContent,"onUpdate:modelValue":a[8]||(a[8]=e=>V.deliContent=e),placeholder:"待发送的消息"},null,8,["modelValue"])])])),_:1},8,["modelValue","before-close"]),(0,s._)("div",x,[(0,s._)("ul",C,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(V.menus,((e,a)=>((0,s.wg)(),(0,s.iD)("li",{class:"liUi",key:a,onClick:e=>z.infoClick(a)},[(0,s._)("span",_,(0,i.zw)(e.name),1)],8,I)))),128))])]),(0,s.Wm)(A,{tabindex:"1001",placement:"top",ref:"dropdown1",trigger:"click",style:{"margin-right":"30px"}},{dropdown:(0,s.w5)((()=>[(0,s.Wm)(E,null,{default:(0,s.w5)((()=>[(0,s.Wm)(j,null,{default:(0,s.w5)((()=>[(0,s.Uk)("Action 1")])),_:1}),(0,s.Wm)(j,null,{default:(0,s.w5)((()=>[(0,s.Uk)("Action 2")])),_:1}),(0,s.Wm)(j,null,{default:(0,s.w5)((()=>[(0,s.Uk)("Action 3")])),_:1})])),_:1})])),_:1},512),(0,s._)("div",S,[(0,s._)("div",W,[(0,s.Wm)(q,{style:{"margin-top":"20px"},"current-page":V.currentPage,"onUpdate:current-page":a[12]||(a[12]=e=>V.currentPage=e),"page-size":V.pageSize,"onUpdate:page-size":a[13]||(a[13]=e=>V.pageSize=e),"page-sizes":[5,10,15,20],small:e.small,disabled:e.disabled,background:e.background,layout:"total, sizes, prev, pager, next, jumper,",total:V.totalDataNum,onSizeChange:z.handleSizeChange,onCurrentChange:z.handleCurrentChange},null,8,["current-page","page-size","small","disabled","background","total","onSizeChange","onCurrentChange"])])])])])])])])])])])])])}t(7658);var z=t(9308),L=t(3274),M=t(5781),B=t(6133),U=t(594),D={name:"message.vue",components:{TopNav:z.Z,LeftNav:L.Z},data(){return{Search:M.olm,Delete:M.HG3,Edit:M.I8b,messagesTableList:[],currentPage:1,pageSize:5,totalDataNum:0,selection:[],currentClickRow:{},messageType:0,menus:[{name:"标记已读",operType:1},{name:"删除消息",operType:2},{name:"发送消息",operType:3},{name:"全部已读",operType:4},{name:"全部删除",operType:5}],deliMessageVisible:!1,deliContent:"",userInfo:{},sendToTeacherInfo:{teacherList:[],sendToTeacherVisible:!1,teacherSelectIndex:"",sendText:""}}},created(){this.userInfo=this.$cookies.get("userInfo")},methods:{rightClick(e,a,t){let s=document.querySelector("#menu");t.preventDefault(),s.style.left=t.clientX-290+"px",s.style.top=t.clientY-150+"px",s.style.display="block",s.style.zIndex=1e3,this.currentClickRow=e},clickTabRow(e,a,t){let s=document.querySelector("#menu");s.style.display="none"},async infoClick(e){if(0===e)await this.markdownARead([this.currentClickRow.id]);else if(1===e)await this.deleteMessage([this.currentClickRow.id]);else if(2===e){if(1===this.messageType)return void B.Z.messageBox("不能对系统发消息","warning");this.deliMessageVisible=!0}else if(3===e){let e=[];for(let a=0;a<this.messagesTableList.length;a++)e.push(this.messagesTableList[a].id);await this.markdownARead(e)}else if(4===e){let e=[];for(let a=0;a<this.messagesTableList.length;a++)e.push(this.messagesTableList[a].id);await this.deleteMessage(e)}let a=document.querySelector("#menu");a.style.display="none"},async deliMessageConfirm(){let e=B.Z.loadingWait("消息发送中。。。","table_studentList");await B.Z.delay(50),(0,U.Z)({method:"POST",url:"message/post",data:{reciId:this.currentClickRow.sendFromId,content:this.deliContent}}).then((async()=>{await B.Z.delay(100),e.close(),B.Z.messageBox("发送成功","success")})).catch((async a=>{await B.Z.delay(100),e.close(),B.Z.print(a),B.Z.messageBox("发送失败","error")}))},async deleteMessage(e){let a=B.Z.loadingWait("删除中。。。","table_studentList");await B.Z.delay(50),await(0,U.Z)({url:"message/delete",headers:{"content-type":"application/json"},method:"POST",data:e}).then((async()=>{B.Z.messageBox("删除成功","success"),await B.Z.delay(50),a.close(),await this.getInitMessages(this.currentPage,this.pageSize)})).catch((async()=>{await B.Z.delay(50),a.close(),B.Z.messageBox("删除失败","error")}))},async markdownARead(e){let a=B.Z.loadingWait("标记中。。。","table_studentList");await B.Z.delay(100),await(0,U.Z)({url:"message/read",method:"POST",headers:{"content-type":"application/json"},data:e}).then((async()=>{await B.Z.delay(100),a.close(),B.Z.messageBox("标记成功","success"),await this.getInitMessages(this.currentPage,this.pageSize)})).catch((async()=>{await B.Z.delay(100),B.Z.messageBox("标记失败","error")}))},async getInitMessages(e,a){this.messageType=0;let t=B.Z.loadingWait("消息获取中。。。","table_studentList");await B.Z.delay(100),await(0,U.Z)({url:`message/query/list/${e}/${a}`,method:"GET",headers:{"content-type":"application/x-www-form-urlencoded;charset=UTF-8"}}).then((async e=>{if(await B.Z.delay(100),t.close(),0===e.data.data.length)return void B.Z.messageBox("暂无消息","success");this.totalDataNum=e.data.data[0].totalSize;let a=[];e.data.data.forEach(((e,t)=>{a.push({status:0===e.status?"未读":"已读",content:e.content,sendFrom:e.sendFrom,sendFromId:e.sendFromId,sendTo:e.sendTo,sendToId:e.sendToId,id:e.id,index:t})})),this.messagesTableList=a,B.Z.messageBox("获取消息成功","success")})).catch((async()=>{await B.Z.delay(100),t.close(),B.Z.messageBox("获取失败","error")}))},async handleSizeChange(e){this.pageSize=e,0===this.messageType?await this.getInitMessages(this.currentPage,e):await this.getSystemMessages(this.currentPage,e)},async handleCurrentChange(e){this.currentPage=e,0===this.messageType?await this.getInitMessages(e,this.pageSize):await this.getSystemMessages(e,this.pageSize)},handleDelete(){},handleSelectionChange(e){this.selection=e},async getInitTeacherList(){let e="message/query/communicative",a=B.Z.loadingWait("获取教师信息。。。","table_studentList");await B.Z.delay(50),await U.Z.get(e).then((async e=>{if(await B.Z.delay(100),a.close(),0===e.data.data.length)return B.Z.messageBox("暂无有更多信息","warning"),this.tableData=[],void(this.totalDataNum=0);B.Z.messageBox("获取教师信息成功","success");for(let a=0;a<e.data.data.length;a++)this.sendToTeacherInfo.teacherList.push({value:a,label:e.data.data[a].name,id:e.data.data[a].id})})).catch((async()=>{await B.Z.delay(100),a.close(),B.Z.messageBox("获取教师信息失败","error")}))},async sendMessageToTeacher(){if(""===this.sendToTeacherInfo.teacherSelectIndex)return void B.Z.messageBox("请选择老师","warning");if(""===this.sendToTeacherInfo.sendText)return void B.Z.messageBox("请输入要发送的内容","success");let e=B.Z.loadingWait("发送中。。。");await B.Z.delay(100),await(0,U.Z)({url:"message/post",method:"post",headers:{"content-type":"application/json"},data:{reciId:this.sendToTeacherInfo.teacherList[this.sendToTeacherInfo.teacherSelectIndex].id,content:this.sendToTeacherInfo.sendText}}).then((async()=>{await B.Z.delay(100),e.close(),B.Z.messageBox("发送成功","success"),this.sendToTeacherInfo.sendText="",this.sendToTeacherInfo.teacherSelectIndex=""})).catch((async()=>{await B.Z.delay(100),e.close(),B.Z.messageBox("发送失败","error")}))},async getSystemMessages(e,a){this.messageType=1;let t=B.Z.loadingWait("获取系统消息中","success");await B.Z.delay(100),await(0,U.Z)({method:"GET",headers:{"content-type":"application/x-www-form-urlencoded;charset=UTF-8"},url:`teacher/message/list/${e}/${a}`}).then((async e=>{await B.Z.delay(100),t.close(),0===e.data.data.length?B.Z.messageBox("暂无系统消息","success"):(this.messagesTableList=e.data.data,this.totalDataNum=e.data.data[0].totalSize,B.Z.messageBox("获取系统消息成功","success"))})).catch((async e=>{await B.Z.delay(100),t.close(),B.Z.messageBox("获取系统消息失败","error")}))}},mounted(){window.addEventListener("beforeunload",(e=>B.Z.destroyCookie(e))),this.getInitMessages(1,5),this.getInitTeacherList()},unmounted(){window.removeEventListener("beforeunload",(e=>B.Z.destroyCookie(e)))}},R=t(3744);const P=(0,R.Z)(D,[["render",V],["__scopeId","data-v-798f8e2a"]]);var F=P}}]);
//# sourceMappingURL=211.d0fe0631.js.map