"use strict";(self["webpackChunkvue"]=self["webpackChunkvue"]||[]).push([[915],{9915:function(e,s,l){l.r(s),l.d(s,{default:function(){return we}});var t=l(6252),a=l(9963),o=l(3577);const i=e=>((0,t.dD)("data-v-e7774e54"),e=e(),(0,t.Cn)(),e),n={class:"wrapper"},r={class:"content-page"},d={class:"content"},c={class:"container-fluid"},m=i((()=>(0,t._)("div",{class:"row"},[(0,t._)("div",{class:"col-12"},[(0,t._)("div",{class:"page-title-box"},[(0,t._)("h4",{class:"page-title"},"历次CSP列表")])])],-1))),p={class:"row mb-2"},u={class:"col-sm-4"},f=i((()=>(0,t._)("i",{class:"mdi mdi-plus"},null,-1))),h=i((()=>(0,t._)("label",{class:"form-label"},"届次",-1))),C=i((()=>(0,t._)("label",{class:"form-label"},"大于某分数奖励次数",-1))),b={class:"mb-3 position-relative",id:"datepicker1"},w=i((()=>(0,t._)("label",{class:"form-label"},"开始时间",-1))),g={class:"block"},I={class:"mb-3 position-relative",id:"datepicker1"},y=i((()=>(0,t._)("label",{class:"form-label"},"截止时间",-1))),_={class:"block"},v={class:"dialog-footer"},T={class:"dialog-footer"},k=i((()=>(0,t._)("label",{class:"form-label"},"届次",-1))),Z=i((()=>(0,t._)("label",{class:"form-label"},"大于某分数奖励次数",-1))),V={class:"mb-3 position-relative",id:"datepicker1"},x=i((()=>(0,t._)("label",{class:"form-label"},"开始时间",-1))),S={class:"block"},U={class:"mb-3 position-relative",id:"datepicker1"},O=i((()=>(0,t._)("label",{class:"form-label"},"截止时间",-1))),W={class:"block"},D={class:"dialog-footer"},P={class:"row"},B={class:"card d-block"},Y={class:"card-body"},L={class:"dropdown card-widgets"},H=i((()=>(0,t._)("a",{href:"#",class:"dropdown-toggle arrow-none","data-bs-toggle":"dropdown","aria-expanded":"false"},[(0,t._)("i",{class:"ri-more-fill"})],-1))),N={class:"dropdown-menu dropdown-menu-end"},j=["onClick"],F=i((()=>(0,t._)("i",{class:"mdi mdi-pencil me-1"},null,-1))),M=["onClick"],z=i((()=>(0,t._)("i",{class:"mdi mdi-delete me-1"},null,-1))),E=["onClick"],$=i((()=>(0,t._)("i",{class:"mdi mdi-star-box me-1"},null,-1))),q=["onClick"],K=i((()=>(0,t._)("i",{class:"mdi mdi-cancel me-1"},null,-1))),A={class:"mt-0"},G={href:"",class:"text-title"},J={class:"mb-1",style:{"margin-top":"10px"}},Q={class:"pe-2 text-nowrap mb-2 d-inline-block"},R=i((()=>(0,t._)("i",{class:"mdi mdi-human-queue text-muted"},null,-1))),X=i((()=>(0,t._)("label",{style:{display:"block"},class:"form-label"},"开始时间",-1))),ee={class:"text-nowrap mb-2 d-inline-block"},se=i((()=>(0,t._)("i",{class:"mdi mdi-timeline-clock-outline text-muted"},null,-1))),le=i((()=>(0,t._)("label",{style:{display:"block"},class:"form-label"},"截止时间",-1))),te={class:"text-nowrap mb-2 d-inline-block"},ae=i((()=>(0,t._)("i",{class:"mdi mdi-timeline-clock-outline text-muted"},null,-1))),oe={style:{display:"block"},class:"form-label"},ie={class:"list-group list-group-flush"},ne={class:"list-group-item p-3"},re={class:"mb-2 fw-bold"},de={class:"float-end"};function ce(e,s,l,i,ce,me){const pe=(0,t.up)("TopNav"),ue=(0,t.up)("LeftNav"),fe=(0,t.up)("el-input"),he=(0,t.up)("el-date-picker"),Ce=(0,t.up)("el-button"),be=(0,t.up)("el-dialog"),we=(0,t.up)("el-option"),ge=(0,t.up)("el-select"),Ie=(0,t.up)("el-progress");return(0,t.wg)(),(0,t.iD)("body",null,[(0,t._)("div",n,[(0,t.Wm)(pe,{ref:"childTopNav"},null,512),(0,t.Wm)(ue),(0,t._)("div",r,[(0,t._)("div",d,[(0,t._)("div",c,[m,(0,t._)("div",p,[(0,t.wy)((0,t._)("div",u,[(0,t._)("span",{onClick:s[0]||(s[0]=e=>ce.createCspVisible=!0),class:"btn btn-danger rounded-pill mb-3"},[f,(0,t.Uk)(" 发布CSP预报名")]),(0,t.Wm)(be,{modelValue:ce.createCspVisible,"onUpdate:modelValue":s[6]||(s[6]=e=>ce.createCspVisible=e),title:"CSP预报名信息",width:"30%",onClose:me.createCspClose},{footer:(0,t.w5)((()=>[(0,t._)("span",v,[(0,t.Wm)(Ce,{onClick:s[5]||(s[5]=e=>ce.createCspVisible=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)("关闭")])),_:1}),(0,t.Wm)(Ce,{type:"primary",onClick:me.createCsp},{default:(0,t.w5)((()=>[(0,t.Uk)(" 发布 ")])),_:1},8,["onClick"])])])),default:(0,t.w5)((()=>[(0,t._)("div",null,[h,(0,t.Wm)(fe,{style:{"margin-bottom":"10px"},modelValue:ce.createCspInfo.number,"onUpdate:modelValue":s[1]||(s[1]=e=>ce.createCspInfo.number=e),placeholder:"输入届次"},null,8,["modelValue"]),C,(0,t.Wm)(fe,{style:{"margin-bottom":"10px"},modelValue:ce.createCspInfo.gtScore,"onUpdate:modelValue":s[2]||(s[2]=e=>ce.createCspInfo.gtScore=e),placeholder:"输入分数"},null,8,["modelValue"]),(0,t._)("div",b,[w,(0,t._)("div",g,[(0,t.Wm)(he,{modelValue:ce.createCspInfo.startTime,"onUpdate:modelValue":s[3]||(s[3]=e=>ce.createCspInfo.startTime=e),type:"datetime",placeholder:"选择开始时间",format:"YYYY/MM/DD HH:mm:ss"},null,8,["modelValue"])])]),(0,t._)("div",I,[y,(0,t._)("div",_,[(0,t.Wm)(he,{modelValue:ce.createCspInfo.endTime,"onUpdate:modelValue":s[4]||(s[4]=e=>ce.createCspInfo.endTime=e),type:"datetime",placeholder:"选择开始时间",format:"YYYY/MM/DD HH:mm:ss"},null,8,["modelValue"])])])])])),_:1},8,["modelValue","onClose"]),(0,t.Wm)(be,{"append-to-body":"true",modelValue:ce.enrollVisible,"onUpdate:modelValue":s[11]||(s[11]=e=>ce.enrollVisible=e),title:`第${ce.currentCspInfo.name}次CSP报名`,width:"30%"},{footer:(0,t.w5)((()=>[(0,t._)("span",T,[(0,t.Wm)(Ce,{onClick:s[9]||(s[9]=e=>me.enrollCancel(ce.enrollVisible=!1))},{default:(0,t.w5)((()=>[(0,t.Uk)("取消")])),_:1}),(0,t.Wm)(Ce,{type:"primary",onClick:s[10]||(s[10]=e=>me.uploadEnrollInfo(ce.currentCspInfo.id))},{default:(0,t.w5)((()=>[(0,t.Uk)(" 确认 ")])),_:1})])])),default:(0,t.w5)((()=>[(0,t._)("div",null,[(0,t.Wm)(ge,{style:{"margin-left":"0!important"},modelValue:ce.enrollInfo.freeOrOwn,"onUpdate:modelValue":s[7]||(s[7]=e=>ce.enrollInfo.freeOrOwn=e),class:"m-2",placeholder:"选择自费或者免费"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(ce.enrollInfo.options,(e=>((0,t.wg)(),(0,t.j4)(we,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),(0,t.Wm)(fe,{modelValue:ce.enrollInfo.extra,"onUpdate:modelValue":s[8]||(s[8]=e=>ce.enrollInfo.extra=e),placeholder:"输入补充信息"},null,8,["modelValue"])])])),_:1},8,["modelValue","title"]),(0,t.Wm)(be,{modelValue:ce.editCspVisible,"onUpdate:modelValue":s[17]||(s[17]=e=>ce.editCspVisible=e),title:"CSP预报名信息修改",width:"30%",onClose:me.editCspClose},{footer:(0,t.w5)((()=>[(0,t._)("span",D,[(0,t.Wm)(Ce,{onClick:s[16]||(s[16]=e=>ce.editCspVisible=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)("关闭")])),_:1}),(0,t.Wm)(Ce,{type:"primary",onClick:me.editCsp},{default:(0,t.w5)((()=>[(0,t.Uk)(" 更新 ")])),_:1},8,["onClick"])])])),default:(0,t.w5)((()=>[(0,t._)("div",null,[k,(0,t.Wm)(fe,{style:{"margin-bottom":"10px"},modelValue:ce.editCspInfo.number,"onUpdate:modelValue":s[12]||(s[12]=e=>ce.editCspInfo.number=e),placeholder:"输入届次"},null,8,["modelValue"]),Z,(0,t.Wm)(fe,{style:{"margin-bottom":"10px"},modelValue:ce.editCspInfo.gtScore,"onUpdate:modelValue":s[13]||(s[13]=e=>ce.editCspInfo.gtScore=e),placeholder:"输入分数"},null,8,["modelValue"]),(0,t._)("div",V,[x,(0,t._)("div",S,[(0,t.Wm)(he,{modelValue:ce.editCspInfo.startTime,"onUpdate:modelValue":s[14]||(s[14]=e=>ce.editCspInfo.startTime=e),type:"datetime",placeholder:"选择开始时间",format:"YYYY/MM/DD HH:mm:ss"},null,8,["modelValue"])])]),(0,t._)("div",U,[O,(0,t._)("div",W,[(0,t.Wm)(he,{modelValue:ce.editCspInfo.endTime,"onUpdate:modelValue":s[15]||(s[15]=e=>ce.editCspInfo.endTime=e),type:"datetime",placeholder:"选择开始时间",format:"YYYY/MM/DD HH:mm:ss"},null,8,["modelValue"])])])])])),_:1},8,["modelValue","onClose"])],512),[[a.F8,1===ce.userInfo.type]])]),(0,t._)("div",P,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(ce.cspInfoList,((e,s)=>((0,t.wg)(),(0,t.iD)("div",{class:"col-md-6 col-xxl-3",style:{width:"300px",height:"300px","margin-bottom":"80px"},key:s},[(0,t._)("div",B,[(0,t._)("div",Y,[(0,t._)("div",L,[H,(0,t._)("div",N,[(0,t.wy)((0,t._)("span",{onClick:e=>me.editCspOpen(s),href:"javascript:void(0);",class:"dropdown-item"},[F,(0,t.Uk)("编辑")],8,j),[[a.F8,1===ce.userInfo.type]]),(0,t.wy)((0,t._)("span",{onClick:s=>me.deleteCspInfo(e.id),href:"javascript:void(0);",class:"dropdown-item"},[z,(0,t.Uk)("删除")],8,M),[[a.F8,1===ce.userInfo.type]]),0===e.registered?(0,t.wy)(((0,t.wg)(),(0,t.iD)("span",{key:0,class:"dropdown-item",href:"javascript:void(0);",onClick:e=>me.enroll(s)},[$,(0,t.Uk)("报名 ")],8,E)),[[a.F8,0===ce.userInfo.type]]):(0,t.kq)("",!0),1===e.registered?(0,t.wy)(((0,t.wg)(),(0,t.iD)("span",{key:1,class:"dropdown-item",href:"javascript:void(0);",onClick:s=>me.deleteEnroll(e.id)},[K,(0,t.Uk)("取消报名")],8,q)),[[a.F8,0===ce.userInfo.type]]):(0,t.kq)("",!0)])]),(0,t._)("h4",A,[(0,t._)("a",G,"第"+(0,o.zw)(e.name)+"次CSP",1)]),(0,t._)("div",{class:(0,o.C_)([ce.proceeClass,"badge"])},(0,o.zw)(this.getProcessionStr(e.startTime,e.endTime)),3),(0,t.Uk)("   "),0===ce.userInfo.type?((0,t.wg)(),(0,t.iD)("div",{key:0,class:(0,o.C_)([1===e.registered?"bg-success":"bg-warning","badge"])},(0,o.zw)(0===e.registered?"未报名":"已报名"),3)):(0,t.kq)("",!0),(0,t._)("p",J,[(0,t._)("span",Q,[R,(0,t._)("b",null,(0,o.zw)(e.personNumber),1),(0,t.Uk)(" 人报名 ")]),X,(0,t._)("span",ee,[se,(0,t._)("b",null," "+(0,o.zw)(e.startTime),1)]),le,(0,t._)("span",te,[ae,(0,t._)("b",null," "+(0,o.zw)(e.endTime),1)]),(0,t._)("label",oe,"当分数大于等于"+(0,o.zw)(e.freeThreshold)+"时可以追加免费次数",1)])]),(0,t._)("ul",ie,[(0,t._)("li",ne,[(0,t._)("p",re,[(0,t.Uk)("进度"),(0,t._)("span",de,(0,o.zw)(me.getProcession(e.startTime,e.endTime))+"%",1)]),(0,t.Wm)(Ie,{percentage:me.getProcession(e.startTime,e.endTime),"show-text":!1},null,8,["percentage"])])])])])))),128))])])])])])])}l(7658);var me=l(9308),pe=l(3274),ue=l(6133),fe=l(594),he={components:{TopNav:me.Z,LeftNav:pe.Z},data(){return{util:ue.Z,createCspInfo:{number:"",startTime:"",endTime:"",gtScore:""},proceeClass:"",enrollVisible:!1,createCspVisible:!1,userInfo:{},cspInfoList:[],currentCspInfo:{},editCspVisible:!1,editCspInfo:{number:"",startTime:"",endTime:"",id:"",gtScore:""},enrollInfo:{options:[],freeOrOwn:"",extra:""}}},name:"index.vue",mounted(){window.addEventListener("beforeunload",(e=>ue.Z.beforeunloadHandle())),window.addEventListener("unload",(e=>ue.Z.unloadHandle())),this.userInfo=this.$cookies.get("userInfo"),0===this.userInfo.freeTime?this.enrollInfo.options.push({value:0,label:"自费"}):this.enrollInfo.options.push({value:0,label:"自费"},{value:1,label:"免费"}),this.getCspInfo()},unmounted(){window.removeEventListener("beforeunload",(e=>ue.Z.beforeunloadHandle())),window.removeEventListener("unload",(e=>ue.Z.unloadHandle()))},methods:{async createCsp(){if(""===this.createCspInfo.endTime||""===this.createCspInfo.startTime||""===this.createCspInfo.number||""===this.createCspInfo.gtScore)return void ue.Z.messageBox("请将信息填写完整","warning");let e=ue.Z.loadingWait("正在发布中...");await ue.Z.delay(100),(0,fe.Z)({url:"teacher/publish/csp",method:"POST",headers:{"content-type":"application/json"},data:{name:this.createCspInfo.number,startTime:ue.Z.timeStampToTime(new Date(this.createCspInfo.startTime).getTime()),endTime:ue.Z.timeStampToTime(new Date(this.createCspInfo.endTime).getTime()),freeThreshold:this.createCspInfo.gtScore}}).then((async()=>{await ue.Z.delay(100),e.close(),ue.Z.messageBox("发布成功","success"),await this.getCspInfo(),this.createCspVisible=!1})).catch((async()=>{await ue.Z.delay(100),e.close(),ue.Z.messageBox("发布失败","error")}))},async deleteCspInfo(e){let s=ue.Z.loadingWait("删除中...");await ue.Z.delay(100),(0,fe.Z)({url:`teacher/publish/delete/${e}`,method:"POST",headers:{"content-type":"application/json;charset=UTF-8"}}).then((async e=>{await ue.Z.delay(100),s.close(),403===e.data.code?ue.Z.messageBox(e.data.msg,"warning"):(ue.Z.messageBox("删除成功","success"),await this.getCspInfo())})).catch((async()=>{await ue.Z.delay(100),s.close(),ue.Z.messageBox("删除失败","error")}))},async editCsp(){if(""===this.editCspInfo.endTime||""===this.editCspInfo.startTime||""===this.editCspInfo.number||""===this.editCspInfo.gtScore)return void ue.Z.messageBox("请将信息填写完整","warning");let e=ue.Z.loadingWait("修改中...");await ue.Z.delay(100),(0,fe.Z)({method:"POST",url:"teacher/publish/modify",headers:{"content-type":"application/json"},data:{id:this.editCspInfo.id,name:this.editCspInfo.number,startTime:ue.Z.timeStampToTime(new Date(this.editCspInfo.startTime).getTime()),endTime:ue.Z.timeStampToTime(new Date(this.editCspInfo.endTime).getTime()),freeThreshold:this.editCspInfo.gtScore}}).then((async()=>{await ue.Z.delay(100),e.close(),ue.Z.messageBox("修改成功","success"),await this.getCspInfo(),this.editCspVisible=!1})).catch((async()=>{await ue.Z.delay(100),e.close(),ue.Z.messageBox("修改失败","error")}))},editCspOpen(e){this.editCspInfo.id=this.cspInfoList[e].id,this.editCspInfo.endTime=this.cspInfoList[e].endTime,this.editCspInfo.startTime=this.cspInfoList[e].startTime,this.editCspInfo.gtScore=this.cspInfoList[e].freeThreshold,this.editCspInfo.number=this.cspInfoList[e].name,this.editCspVisible=!0},editCspClose(){this.editCspInfo.endTime="",this.editCspInfo.startTime="",this.editCspInfo.number="",this.editCspInfo.gtScore=""},createCspClose(){this.createCspInfo.endTime="",this.createCspInfo.startTime="",this.createCspInfo.number="",this.createCspInfo.gtScore=""},getProcessionStr(e,s){let l=this.getProcessionNum(e,s);return l<0?(this.proceeClass="bg-dark-lighten","未开始"):l>100?(this.proceeClass="bg-waring","已结束"):(this.proceeClass="bg-success","报名中")},getProcession(e,s){let l=this.getProcessionNum(e,s);return l<0?0:l>100?100:l},getProcessionNum(e,s){let l=new Date(e).valueOf(),t=new Date(s).valueOf(),a=(new Date).valueOf(),o=(a-l)/(t-l),i=100*Number(o).toFixed(2);return Number(i)>=100?101:Number(i)<0?-1:Math.ceil(Number(i))},async uploadEnrollInfo(e){if(0===this.userInfo.freeOrOwn&&1===this.enrollInfo.freeOrOwn)return void ue.Z.messageBox("您的免费次数不足只能选择自费");let s=ue.Z.loadingWait("报名中...");await ue.Z.delay(50),await(0,fe.Z)({method:"POST",url:"pre/reg",headers:{"content-type":"application/json;charset=UTF-8"},data:{cspId:e,type:this.enrollInfo.freeOrOwn,extra:this.enrollInfo.extra}}).then((async e=>{await ue.Z.delay(100),s.close(),403===e.data.code?ue.Z.messageBox(e.data.msg,"warning"):(ue.Z.messageBox("报名成功","success"),this.enrollInfo.extra="",this.enrollInfo.freeOrOwn="",this.enrollVisible=!1,await this.getCspInfo()),this.enrollInfo.extra="",this.enrollInfo.freeOrOwn=""})).catch((async e=>{await ue.Z.delay(100),s.close(),ue.Z.messageBox(e.data.msg,"error")}))},async getCspInfo(){let e=ue.Z.loadingWait("拉取CSP信息中...");await ue.Z.delay(200),await this.$axios.get("csp_info/pre").then((async s=>{await ue.Z.delay(100),e.close(),ue.Z.messageBox("CSP信息拉取成功","success"),this.cspInfoList=s.data.data})).catch((async()=>{await ue.Z.delay(100),e.close(),ue.Z.messageBox("拉取CSP信息失败","error")}))},enroll(e){this.enrollVisible=!0,this.currentCspInfo=this.cspInfoList[e]},enrollCancel(){this.enrollInfo.extra="",this.enrollInfo.freeOrOwn=""},async deleteEnroll(e){let s=ue.Z.loadingWait("取消报名中...");await ue.Z.delay(50),(0,fe.Z)({method:"POST",headers:{"content-type":"application/x-www-form-urlencoded;charset=UTF-8"},url:`pre/reg/cancel/${e}`}).then((async e=>{await ue.Z.delay(100),s.close(),403===e.data.code?ue.Z.messageBox("您没有报名，请勿随意操作","warning"):(ue.Z.messageBox("取消报名成功","success"),await this.getCspInfo())})).catch((async()=>{await ue.Z.delay(100),s.close(),ue.Z.messageBox("取消报名失败","error")}))}}},Ce=l(3744);const be=(0,Ce.Z)(he,[["render",ce],["__scopeId","data-v-e7774e54"]]);var we=be}}]);
//# sourceMappingURL=915.7a81a37f.js.map