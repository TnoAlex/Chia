"use strict";(self["webpackChunkvue"]=self["webpackChunkvue"]||[]).push([[231],{7231:function(e,a,t){t.r(a),t.d(a,{default:function(){return F}});var l=t(6252),s=t(3577),i=t(9963);const o=e=>((0,l.dD)("data-v-79ce6f5a"),e=e(),(0,l.Cn)(),e),n={class:"wrapper"},r={class:"content-page"},c={class:"content"},d={class:"container-fluid"},p=(0,l.uE)('<div class="row" data-v-79ce6f5a><div class="col-12" data-v-79ce6f5a><div class="page-title-box" data-v-79ce6f5a><div class="page-title-right" data-v-79ce6f5a><ol class="breadcrumb m-0" data-v-79ce6f5a></ol></div><h4 class="page-title" data-v-79ce6f5a>学生报名信息管理</h4></div></div></div>',1),u={class:"row"},h={class:"col-12"},m={class:"card"},g={class:"card-body"},w={style:{"margin-bottom":"10px"}},y={style:{"margin-bottom":"0!important",display:"inline-block","justify-content":"center","align-items":"center"}},b=o((()=>(0,l._)("span",{style:{"margin-right":"5px!important"}}," 届数选择 ",-1))),f={style:{"margin-bottom":"10px"}},x={style:{"margin-bottom":"0!important",display:"inline-block","justify-content":"center","align-items":"center"}},v=o((()=>(0,l._)("span",{style:{"margin-right":"5px!important"}}," 导出选项 ",-1))),S=o((()=>(0,l._)("span",null,"点击查询",-1))),Z={style:{"margin-bottom":"10px"}},C={style:{"margin-top":"0!important",display:"inline-block","justify-content":"center","align-items":"center"}},_={class:"row mb-2"},N={class:"col-sm-5"},E={class:"btn btn-danger mb-2"},$=o((()=>(0,l._)("i",{class:"mdi mdi-plus-circle me-2"},null,-1))),k={class:"col-sm-7"},D={class:"text-sm-end"},W={style:{float:"right"}},B={style:{float:"right",position:"relative"}};function L(e,a,t,o,L,z){const I=(0,l.up)("TopNav"),T=(0,l.up)("LeftNav"),U=(0,l.up)("el-option"),j=(0,l.up)("el-select"),P=(0,l.up)("el-button"),q=(0,l.up)("el-upload"),V=(0,l.up)("el-table-column"),F=(0,l.up)("el-table"),O=(0,l.up)("el-pagination"),A=(0,l.Q2)("loading");return(0,l.wg)(),(0,l.iD)("body",null,[(0,l._)("div",n,[(0,l.Wm)(I),(0,l.Wm)(T),(0,l._)("div",r,[(0,l._)("div",c,[(0,l._)("div",d,[p,(0,l._)("div",u,[(0,l._)("div",h,[(0,l._)("div",m,[(0,l._)("div",g,[(0,l._)("div",w,[(0,l._)("span",y,[b,(0,l.Wm)(j,{modelValue:L.nowCspSelect,"onUpdate:modelValue":a[0]||(a[0]=e=>L.nowCspSelect=e),class:"m-2",clearable:"",placeholder:"选择CSP届数",style:{"margin-bottom":"0!important","margin-top":"0!important","margin-left":"0!important",display:"inline-block"}},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(L.cspNameSelectList,(e=>((0,l.wg)(),(0,l.j4)(U,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])]),(0,l._)("div",f,[(0,l._)("span",x,[v,(0,l.Wm)(j,{modelValue:L.nowExportSelect,"onUpdate:modelValue":a[1]||(a[1]=e=>L.nowExportSelect=e),class:"m-2",clearable:"",placeholder:"选择视图",style:{"margin-bottom":"0!important","margin-top":"0!important","margin-left":"0!important",display:"inline-block"}},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(L.exportList,(e=>((0,l.wg)(),(0,l.j4)(U,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),S,(0,l.Uk)("  "),(0,l.Wm)(P,{icon:L.Search,circle:"",onClick:a[2]||(a[2]=e=>z.searchShow(1,5))},null,8,["icon"])])]),(0,l._)("div",Z,[(0,l._)("span",C,[(0,l.Wm)(q,{ref:"upload",style:{display:"inline-block","margin-right":"20px"},"auto-upload":!1,"on-change":z.handleExcel,"show-file-list":!1,action:"##"},{default:(0,l.w5)((()=>[(0,l.Wm)(P,{type:"primary",size:"small"},{default:(0,l.w5)((()=>[(0,l.Uk)("导入正式报名表")])),_:1})])),_:1},8,["on-change"]),(0,l.Wm)(q,{ref:"uploadScore",style:{display:"inline-block","margin-right":"20px"},action:"##","auto-upload":!1,"show-file-list":!1,"on-change":z.handleScoreExcel},{default:(0,l.w5)((()=>[(0,l.Wm)(P,{type:"primary",size:"small"},{default:(0,l.w5)((()=>[(0,l.Uk)("成绩单上传")])),_:1})])),_:1},8,["on-change"]),(0,l.Wm)(P,{onClick:z.sendMessageToAllAbsence,type:"primary",size:"small"},{default:(0,l.w5)((()=>[(0,l.Uk)("提醒学生参与正式报名")])),_:1},8,["onClick"])])]),(0,l._)("div",_,[(0,l._)("div",N,[(0,l._)("span",E,[$,(0,l.Uk)(" "+(0,s.zw)(this.tableName),1)])]),(0,l._)("div",k,[(0,l._)("div",D,[(0,l.Wm)(P,{size:"large",type:"success",onClick:z.exportExcel},{default:(0,l.w5)((()=>[(0,l.Uk)("导出")])),_:1},8,["onClick"])])]),(0,l.wy)(((0,l.wg)(),(0,l.j4)(F,{id:"table_studentList",ref:"multipleTableRef",data:L.tableData,border:"",fit:"",stripe:"true",style:{width:"100%"},onSelectionChange:z.handleSelectionChange},{default:(0,l.w5)((()=>[(0,l.Wm)(V,{type:"selection",width:"55px"}),(0,l.Wm)(V,{label:"学号",property:"studentNumber","show-overflow-tooltip":"",width:"200px"}),(0,l.Wm)(V,{label:"姓名",property:"name","show-overflow-tooltip":"",width:"150px"}),(0,l.Wm)(V,{label:"年级",property:"grade","show-overflow-tooltip":"",width:"80px"}),(0,l.Wm)(V,{label:"最高分",property:"maxScore","show-overflow-tooltip":"",width:"80px"}),(0,l.Wm)(V,{label:"免费次数",property:"freeTime","show-overflow-tooltip":""}),(0,l.wy)((0,l.Wm)(V,{label:"报名说明",property:"extra","show-overflow-tooltip":""},null,512),[[i.F8,4===L.nowExportSelect]])])),_:1},8,["data","onSelectionChange"])),[[A,L.tableLoading]]),(0,l._)("div",W,[(0,l._)("div",B,[(0,l.Wm)(O,{"current-page":L.currentPage,"onUpdate:current-page":a[3]||(a[3]=e=>L.currentPage=e),"page-size":L.pageSize,"onUpdate:page-size":a[4]||(a[4]=e=>L.pageSize=e),"page-sizes":[5,10,15,20],total:L.tableDataNum,layout:"total, sizes, prev, pager, next, jumper,",small:"small",style:{"margin-top":"20px"},onSizeChange:z.handleSizeChange,onCurrentChange:z.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])])])])])])])])])])])}t(7658);var z=t(9308),I=t(3274),T=t(5781),U=t(6133),j=t(594),P={name:"studentList.vue",components:{TopNav:z.Z,LeftNav:I.Z},data(){return{Search:T.olm,Delete:T.HG3,Edit:T.I8b,exportList:[{value:4,label:"预报名名单"},{value:0,label:"未有正式报名"},{value:1,label:"缺席考试名单"},{value:2,label:"正式报名错误"},{value:3,label:"正式报名正确"}],currentExportUrl:"",nowExportSelect:"",tableName:"请选择视图",searchInfo:{nameOrStudentNumber:"",grade:"",freeTime:"",scoreFilter:"",score:""},addInfoConfirmVisible:!1,addInfoDialogVisible:!1,confirmMessage:"",isConfirm:!1,confirmType:1,currentPage:1,pageSize:5,tableLoading:!1,selection:[],cspInfoList:[],cspNameSelectList:[],nowCspSelect:"",tableData:[],tableDataNum:0}},methods:{async exportExcel(){if(""===this.nowCspSelect||""===this.nowExportSelect)return void U.Z.messageBox("选择届次与导出选项才能导出","warning");if(""===this.currentExportUrl)return void U.Z.messageBox("请先点击搜索按钮，获取部分数据","warning");if(0===this.tableDataNum)return void U.Z.messageBox("暂无可导出的数据","warning");let e=U.Z.loadingWait("获取导出数据中","table_studentList");await U.Z.delay(100),await(0,j.Z)({url:this.currentExportUrl,method:"GET"}).then((async a=>{await U.Z.delay(100),e.close(),U.Z.messageBox("获取数据成功，即将导出","success");let t=[];for(let e=0;e<a.data.data.length;e++)t.push({"学号":a.data.data[e]["studentNumber"],"姓名":a.data.data[e]["name"],"年级":a.data.data[e]["grade"],"最高分":a.data.data[e]["maxScore"],"免费次数":a.data.data[e]["freeTime"]});U.Z.exportExcel(t,"第"+this.cspNameSelectList[this.nowCspSelect].label+"届"+this.tableName)})).catch((async()=>{await U.Z.delay(100),e.close(),U.Z.messageBox("获取数据失败，导出失败","error")})),this.currentExportUrl=""},async searchShow(e,a){if(""===this.nowCspSelect||""===this.nowExportSelect)return void U.Z.messageBox("选择届次与导出选项才能展示","warning");let t="",l=this.cspNameSelectList[this.nowCspSelect].cspId;0===this.nowExportSelect?(t=`teacher/query/absent/official/${l}/${e}/${a}`,this.tableName="未正式报名表",await this.getTableData(t,e,a),this.currentExportUrl=`teacher/query/absent/official/${l}/0/${this.tableDataNum}`):1===this.nowExportSelect?(t=`teacher/query/absent/exam/${l}/${e}/${a}`,this.tableName="缺考表",await this.getTableData(t,e,a),this.currentExportUrl=`teacher/query/absent/exam/${l}/0/${this.tableDataNum}`):2===this.nowExportSelect?(t=`teacher/query/wrong/${l}/${e}/${a}`,this.tableName="错报团表",await this.getTableData(t,e,a),this.currentExportUrl=`teacher/query/wrong/${l}/0/${this.tableDataNum}`):3===this.nowExportSelect?(t=`teacher/query/official/${l}/${e}/${a}`,this.tableName="正式报名表",await this.getTableData(t,e,a),this.currentExportUrl=`teacher/query/official/${l}/0/${this.tableDataNum}`):4===this.nowExportSelect&&(t=`pre/reg/list/${l}/${e}/${a}`,this.tableName="预报名表",await this.getTableData(t,e,a),this.currentExportUrl=`pre/reg/list/${l}/0/${this.tableDataNum}`)},async getTableData(e,a,t){let l=U.Z.loadingWait("获取数据中","table_studentList");await U.Z.delay(100),await(0,j.Z)({url:e,method:"GET"}).then((async e=>{if(await U.Z.delay(100),l.close(),console.log(e),null===e.data.data)return U.Z.messageBox(e.data.msg,"warning"),void(this.tableDataNum=0);0===e.data.data.length?(this.tableDataNum=0,U.Z.messageBox("暂无数据","success")):(U.Z.messageBox("获取数据成功","success"),this.tableDataNum=e.data.data[0].totalSize,this.tableData=e.data.data,this.pageSize=t,this.currentPage=a,console.log(e.data.data),console.log(this.tableDataNum))})).catch((async e=>{console.log(e),await U.Z.delay(100),l.close(),U.Z.messageBox("获取数据失败","error")}))},async handleSizeChange(e){this.pageSize=e,await this.searchShow(this.currentPage,this.pageSize)},async handleCurrentChange(e){this.currentPage=e,await this.searchShow(this.currentPage,this.pageSize)},handleSelectionChange(e){this.selection=e},async handleExcel(e){if(""===this.nowCspSelect)return void U.Z.messageBox("请先选择届次","warning");let a=t(4105),l=e.raw;if(!l)return;let s=U.Z.loadingWait("解析表格中......");await U.Z.delay(100);let i=await U.Z.readFile(l),o=a.read(i,{type:"binary"}),n=o.Sheets[o.SheetNames[0]],r=a.utils.sheet_to_json(n,{range:2}),c=Object.keys(r[0]),d=0,p=0,u=0;for(let t=0;t<c.length;t++)"学号"===c[t]?d=t:"团报单位"===c[t]?p=t:"报名状态"===c[t]&&(u=t);let h=[];for(let t=0;t<r.length;t++){let e=Object.values(r[t]);if("未提交报名"!==e[u]){let a=e[p],t=0;t="南京理工大学"===a?1:0,h.push({studentIdNumber:e[d].toString(),cspId:this.cspNameSelectList[this.nowCspSelect].cspId,type:t})}}await U.Z.delay(100),s.close(),U.Z.messageBox("解析成功","success"),this.$refs.upload.clearFiles(),await this.uploadExcelInfo(h)},async handleScoreExcel(e){if(""===this.nowCspSelect)return void U.Z.messageBox("请先选择届次","warning");let a=t(4105),l=e.raw;if(!l)return;let s=U.Z.loadingWait("解析表格中......");await U.Z.delay(100);let i=await U.Z.readFile(l),o=a.read(i,{type:"binary"}),n=o.Sheets[o.SheetNames[0]],r=a.utils.sheet_to_json(n,{range:2}),c=[],d=Object.keys(r[0]),p=0,u=0;for(let t=0;t<d.length;t++)"学号"===d[t]?p=t:"认证总分"===d[t]&&(u=t);for(let t=0;t<r.length;t++){let e=Object.values(r[t]);c.push({studentIdNumber:e[p].toString(),cspId:this.cspNameSelectList[this.nowCspSelect].cspId,score:e[u]})}await U.Z.delay(100),s.close(),U.Z.messageBox("解析成功","success"),this.$refs.uploadScore.clearFiles(),await this.uploadScoreExcelInfo(c)},async uploadScoreExcelInfo(e){let a=U.Z.loadingWait("上传中。。。","table_studentList");await U.Z.delay(100),await(0,j.Z)({method:"POST",headers:{"content-type":"application/json"},url:"teacher/upload/transcripts",data:e}).then((async()=>{await U.Z.delay(100),a.close(),U.Z.messageBox("上传成功","success")})).catch((async()=>{await U.Z.delay(100),a.close(),U.Z.messageBox("成绩更新失败","error")}))},async uploadExcelInfo(e){let a=U.Z.loadingWait("上传信息中。。。");await U.Z.delay(50);let t=1;return await(0,j.Z)({headers:{"content-type":"application/json"},method:"post",url:"teacher/upload/regList",data:e}).then((e=>{if(403===e.data.code)return U.Z.messageBox(e.data.msg,"error"),0})).catch((()=>{t=0})),await U.Z.delay(100),a.close(),0===t?(U.Z.messageBox("上传正式报名表格失败","error"),0):(U.Z.messageBox("上传正式报名表格成功","success"),1)},async sendMessageToAllAbsence(){if(""===this.nowCspSelect)return void U.Z.messageBox("请先选择届次","warning");let e=U.Z.loadingWait("发送中");await U.Z.delay(100),await(0,j.Z)({method:"POST",headers:{"content-type":"application/x-www-form-urlencoded;charset=UTF-8"},url:`teacher/notice/official/${this.cspNameSelectList[this.nowCspSelect].cspId}/`}).then((async()=>{e.close(),await U.Z.delay(100),U.Z.messageBox("发送成功","success")})).catch((async()=>{e.close(),await U.Z.delay(100),U.Z.messageBox("发送失败","error")}))},async getCspInfo(){let e=U.Z.loadingWait("拉取CSP届次中。。。");await U.Z.delay(200),await this.$axios.get("csp_info/pre").then((async a=>{if(await U.Z.delay(100),e.close(),U.Z.messageBox("CSP届次拉取成功","success"),a.data.data.length>0){for(let e=0;e<a.data.data.length;e++)this.cspNameSelectList.push({value:e,label:a.data.data[e].name,cspId:a.data.data[e].id});this.cspInfoList=a.data.data}})).catch((async()=>{await U.Z.delay(100),e.close(),U.Z.messageBox("拉取CSP届次失败","error")}))}},created(){this.getCspInfo()},mounted(){window.addEventListener("beforeunload",(e=>U.Z.destroyCookie(e)))},unmounted(){window.removeEventListener("beforeunload",(e=>U.Z.destroyCookie(e)))}},q=t(3744);const V=(0,q.Z)(P,[["render",L],["__scopeId","data-v-79ce6f5a"]]);var F=V}}]);
//# sourceMappingURL=231.f6118bd6.js.map