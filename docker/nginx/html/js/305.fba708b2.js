"use strict";(self["webpackChunkvue"]=self["webpackChunkvue"]||[]).push([[305],{1305:function(e,l,s){s.r(l),s.d(l,{default:function(){return ge}});var t=s(6252),a=s(9963),o=s(3577);const i=e=>((0,t.dD)("data-v-49619937"),e=e(),(0,t.Cn)(),e),n={class:"wrapper"},r={class:"content-page"},d={class:"content"},c={class:"container-fluid"},m=i((()=>(0,t._)("div",{class:"row"},[(0,t._)("div",{class:"col-12"},[(0,t._)("div",{class:"page-title-box"},[(0,t._)("h4",{class:"page-title"},"历次CSP列表")])])],-1))),p={class:"row mb-2"},u={class:"col-sm-4"},f=i((()=>(0,t._)("i",{class:"mdi mdi-plus"},null,-1))),h=i((()=>(0,t._)("label",{class:"form-label"},"届次",-1))),C=i((()=>(0,t._)("label",{class:"form-label"},"大于某分数奖励次数",-1))),b={class:"mb-3 position-relative",id:"datepicker1"},w=i((()=>(0,t._)("label",{class:"form-label"},"开始时间",-1))),g={class:"block"},I={class:"mb-3 position-relative",id:"datepicker1"},y=i((()=>(0,t._)("label",{class:"form-label"},"截止时间",-1))),_={class:"block"},v={class:"dialog-footer"},T={class:"dialog-footer"},k=i((()=>(0,t._)("label",{class:"form-label"},"届次",-1))),V=i((()=>(0,t._)("label",{class:"form-label"},"大于某分数奖励次数",-1))),Z={class:"mb-3 position-relative",id:"datepicker1"},x=i((()=>(0,t._)("label",{class:"form-label"},"开始时间",-1))),S={class:"block"},U={class:"mb-3 position-relative",id:"datepicker1"},O=i((()=>(0,t._)("label",{class:"form-label"},"截止时间",-1))),W={class:"block"},P={class:"dialog-footer"},D={class:"row"},B={class:"card d-block"},Y={class:"card-body"},L={class:"dropdown card-widgets"},N=i((()=>(0,t._)("a",{href:"#",class:"dropdown-toggle arrow-none","data-bs-toggle":"dropdown","aria-expanded":"false"},[(0,t._)("i",{class:"ri-more-fill"})],-1))),H={class:"dropdown-menu dropdown-menu-end"},j=["onClick"],F=i((()=>(0,t._)("i",{class:"mdi mdi-pencil me-1"},null,-1))),M=["onClick"],z=i((()=>(0,t._)("i",{class:"mdi mdi-delete me-1"},null,-1))),E=["onClick"],$=i((()=>(0,t._)("i",{class:"mdi mdi-star-box me-1"},null,-1))),K=["onClick"],q=i((()=>(0,t._)("i",{class:"mdi mdi-cancel me-1"},null,-1))),A={class:"mt-0"},G={href:"",class:"text-title"},J={class:"badge bg-success"},Q={class:"mb-1"},R={class:"pe-2 text-nowrap mb-2 d-inline-block"},X=i((()=>(0,t._)("i",{class:"mdi mdi-human-queue text-muted"},null,-1))),ee=i((()=>(0,t._)("label",{style:{display:"block"},class:"form-label"},"开始时间",-1))),le={class:"text-nowrap mb-2 d-inline-block"},se=i((()=>(0,t._)("i",{class:"mdi mdi-timeline-clock-outline text-muted"},null,-1))),te=i((()=>(0,t._)("label",{style:{display:"block"},class:"form-label"},"截止时间",-1))),ae={class:"text-nowrap mb-2 d-inline-block"},oe=i((()=>(0,t._)("i",{class:"mdi mdi-timeline-clock-outline text-muted"},null,-1))),ie={style:{display:"block"},class:"form-label"},ne={class:"list-group list-group-flush"},re={class:"list-group-item p-3"},de={class:"mb-2 fw-bold"},ce={class:"float-end"};function me(e,l,s,i,me,pe){const ue=(0,t.up)("TopNav"),fe=(0,t.up)("LeftNav"),he=(0,t.up)("el-input"),Ce=(0,t.up)("el-date-picker"),be=(0,t.up)("el-button"),we=(0,t.up)("el-dialog"),ge=(0,t.up)("el-option"),Ie=(0,t.up)("el-select"),ye=(0,t.up)("el-progress");return(0,t.wg)(),(0,t.iD)("body",null,[(0,t._)("div",n,[(0,t.Wm)(ue,{ref:"childTopNav"},null,512),(0,t.Wm)(fe),(0,t._)("div",r,[(0,t._)("div",d,[(0,t._)("div",c,[m,(0,t._)("div",p,[(0,t.wy)((0,t._)("div",u,[(0,t._)("span",{onClick:l[0]||(l[0]=e=>me.createCspVisible=!0),class:"btn btn-danger rounded-pill mb-3"},[f,(0,t.Uk)(" 发布CSP预报名")]),(0,t.Wm)(we,{modelValue:me.createCspVisible,"onUpdate:modelValue":l[6]||(l[6]=e=>me.createCspVisible=e),title:"CSP预报名信息",width:"30%",onClose:pe.createCspClose},{footer:(0,t.w5)((()=>[(0,t._)("span",v,[(0,t.Wm)(be,{onClick:l[5]||(l[5]=e=>me.createCspVisible=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)("关闭")])),_:1}),(0,t.Wm)(be,{type:"primary",onClick:pe.createCsp},{default:(0,t.w5)((()=>[(0,t.Uk)(" 发布 ")])),_:1},8,["onClick"])])])),default:(0,t.w5)((()=>[(0,t._)("div",null,[h,(0,t.Wm)(he,{style:{"margin-bottom":"10px"},modelValue:me.createCspInfo.number,"onUpdate:modelValue":l[1]||(l[1]=e=>me.createCspInfo.number=e),placeholder:"输入届次"},null,8,["modelValue"]),C,(0,t.Wm)(he,{style:{"margin-bottom":"10px"},modelValue:me.createCspInfo.gtScore,"onUpdate:modelValue":l[2]||(l[2]=e=>me.createCspInfo.gtScore=e),placeholder:"输入分数"},null,8,["modelValue"]),(0,t._)("div",b,[w,(0,t._)("div",g,[(0,t.Wm)(Ce,{modelValue:me.createCspInfo.startTime,"onUpdate:modelValue":l[3]||(l[3]=e=>me.createCspInfo.startTime=e),type:"datetime",placeholder:"选择开始时间",format:"YYYY/MM/DD HH:mm:ss"},null,8,["modelValue"])])]),(0,t._)("div",I,[y,(0,t._)("div",_,[(0,t.Wm)(Ce,{modelValue:me.createCspInfo.endTime,"onUpdate:modelValue":l[4]||(l[4]=e=>me.createCspInfo.endTime=e),type:"datetime",placeholder:"选择开始时间",format:"YYYY/MM/DD HH:mm:ss"},null,8,["modelValue"])])])])])),_:1},8,["modelValue","onClose"]),(0,t.Wm)(we,{"append-to-body":"true",modelValue:me.enrollVisible,"onUpdate:modelValue":l[11]||(l[11]=e=>me.enrollVisible=e),title:`第${me.currentCspInfo.name}次CSP报名`,width:"30%"},{footer:(0,t.w5)((()=>[(0,t._)("span",T,[(0,t.Wm)(be,{onClick:l[9]||(l[9]=e=>pe.enrollCancel(me.enrollVisible=!1))},{default:(0,t.w5)((()=>[(0,t.Uk)("取消")])),_:1}),(0,t.Wm)(be,{type:"primary",onClick:l[10]||(l[10]=e=>pe.uploadEnrollInfo(me.currentCspInfo.id))},{default:(0,t.w5)((()=>[(0,t.Uk)(" 确认 ")])),_:1})])])),default:(0,t.w5)((()=>[(0,t._)("div",null,[(0,t.Wm)(Ie,{style:{"margin-left":"0!important"},modelValue:me.enrollInfo.freeOrOwn,"onUpdate:modelValue":l[7]||(l[7]=e=>me.enrollInfo.freeOrOwn=e),class:"m-2",placeholder:"选择自费或者免费"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(me.enrollInfo.options,(e=>((0,t.wg)(),(0,t.j4)(ge,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),(0,t.Wm)(he,{modelValue:me.enrollInfo.extra,"onUpdate:modelValue":l[8]||(l[8]=e=>me.enrollInfo.extra=e),placeholder:"输入补充信息"},null,8,["modelValue"])])])),_:1},8,["modelValue","title"]),(0,t.Wm)(we,{modelValue:me.editCspVisible,"onUpdate:modelValue":l[17]||(l[17]=e=>me.editCspVisible=e),title:"CSP预报名信息修改",width:"30%",onClose:pe.editCspClose},{footer:(0,t.w5)((()=>[(0,t._)("span",P,[(0,t.Wm)(be,{onClick:l[16]||(l[16]=e=>me.editCspVisible=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)("关闭")])),_:1}),(0,t.Wm)(be,{type:"primary",onClick:pe.editCsp},{default:(0,t.w5)((()=>[(0,t.Uk)(" 更新 ")])),_:1},8,["onClick"])])])),default:(0,t.w5)((()=>[(0,t._)("div",null,[k,(0,t.Wm)(he,{style:{"margin-bottom":"10px"},modelValue:me.editCspInfo.number,"onUpdate:modelValue":l[12]||(l[12]=e=>me.editCspInfo.number=e),placeholder:"输入届次"},null,8,["modelValue"]),V,(0,t.Wm)(he,{style:{"margin-bottom":"10px"},modelValue:me.editCspInfo.gtScore,"onUpdate:modelValue":l[13]||(l[13]=e=>me.editCspInfo.gtScore=e),placeholder:"输入分数"},null,8,["modelValue"]),(0,t._)("div",Z,[x,(0,t._)("div",S,[(0,t.Wm)(Ce,{modelValue:me.editCspInfo.startTime,"onUpdate:modelValue":l[14]||(l[14]=e=>me.editCspInfo.startTime=e),type:"datetime",placeholder:"选择开始时间",format:"YYYY/MM/DD HH:mm:ss"},null,8,["modelValue"])])]),(0,t._)("div",U,[O,(0,t._)("div",W,[(0,t.Wm)(Ce,{modelValue:me.editCspInfo.endTime,"onUpdate:modelValue":l[15]||(l[15]=e=>me.editCspInfo.endTime=e),type:"datetime",placeholder:"选择开始时间",format:"YYYY/MM/DD HH:mm:ss"},null,8,["modelValue"])])])])])),_:1},8,["modelValue","onClose"])],512),[[a.F8,1===me.userInfo.type]])]),(0,t._)("div",D,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(me.cspInfoList,((e,l)=>((0,t.wg)(),(0,t.iD)("div",{class:"col-md-6 col-xxl-3",style:{width:"300px",height:"300px","margin-bottom":"80px"},key:l},[(0,t._)("div",B,[(0,t._)("div",Y,[(0,t._)("div",L,[N,(0,t._)("div",H,[(0,t.wy)((0,t._)("span",{onClick:e=>pe.editCspOpen(l),href:"javascript:void(0);",class:"dropdown-item"},[F,(0,t.Uk)("编辑")],8,j),[[a.F8,1===me.userInfo.type]]),(0,t.wy)((0,t._)("span",{onClick:l=>pe.deleteCspInfo(e.id),href:"javascript:void(0);",class:"dropdown-item"},[z,(0,t.Uk)("删除")],8,M),[[a.F8,1===me.userInfo.type]]),(0,t.wy)((0,t._)("span",{onClick:e=>pe.enroll(l),href:"javascript:void(0);",class:"dropdown-item"},[$,(0,t.Uk)("报名 ")],8,E),[[a.F8,0===me.userInfo.type]]),(0,t.wy)((0,t._)("span",{onClick:l=>pe.deleteEnroll(e.id),href:"javascript:void(0);",class:"dropdown-item"},[q,(0,t.Uk)("取消报名")],8,K),[[a.F8,0===me.userInfo.type]])])]),(0,t._)("h4",A,[(0,t._)("a",G,"第"+(0,o.zw)(e.name)+"次CSP",1)]),(0,t._)("div",J,(0,o.zw)(this.getProcessionStr(e.startTime,e.endTime)),1),(0,t._)("p",Q,[(0,t._)("span",R,[X,(0,t._)("b",null,(0,o.zw)(e.personNumber),1),(0,t.Uk)(" 人报名 ")]),ee,(0,t._)("span",le,[se,(0,t._)("b",null," "+(0,o.zw)(e.startTime),1)]),te,(0,t._)("span",ae,[oe,(0,t._)("b",null," "+(0,o.zw)(e.endTime),1)]),(0,t._)("label",ie,"当分数大于等于"+(0,o.zw)(e.freeThreshold)+"时可以追加免费次数",1)])]),(0,t._)("ul",ne,[(0,t._)("li",re,[(0,t._)("p",de,[(0,t.Uk)("进度"),(0,t._)("span",ce,(0,o.zw)(pe.getProcession(e.startTime,e.endTime))+"%",1)]),(0,t.Wm)(ye,{percentage:pe.getProcession(e.startTime,e.endTime),"show-text":!1},null,8,["percentage"])])])])])))),128))])])])])])])}var pe=s(9308),ue=s(3274),fe=s(6133),he=s(594),Ce={components:{TopNav:pe.Z,LeftNav:ue.Z},data(){return{util:fe.Z,createCspInfo:{number:"",startTime:"",endTime:"",gtScore:""},enrollVisible:!1,createCspVisible:!1,userInfo:{},cspInfoList:[],currentCspInfo:{},editCspVisible:!1,editCspInfo:{number:"",startTime:"",endTime:"",id:"",gtScore:""},enrollInfo:{options:[{value:0,label:"自费"},{value:1,label:"免费"}],freeOrOwn:"",extra:""}}},name:"index.vue",mounted(){window.addEventListener("beforeunload",(e=>fe.Z.destroyCookie(e))),this.userInfo=this.$cookies.get("userInfo"),this.getCspInfo()},unmounted(){window.removeEventListener("beforeunload",(e=>fe.Z.destroyCookie(e)))},methods:{async createCsp(){if(""===this.createCspInfo.endTime||""===this.createCspInfo.startTime||""===this.createCspInfo.number||""===this.createCspInfo.gtScore)return void fe.Z.messageBox("请将信息填写完整","warning");let e=fe.Z.loadingWait("正在发布中...");await fe.Z.delay(100),(0,he.Z)({url:"teacher/publish/csp",method:"POST",headers:{"content-type":"application/json"},data:{name:this.createCspInfo.number,startTime:fe.Z.timeStampToTime(new Date(this.createCspInfo.startTime).getTime()),endTime:fe.Z.timeStampToTime(new Date(this.createCspInfo.endTime).getTime()),freeThreshold:this.createCspInfo.gtScore}}).then((async()=>{await fe.Z.delay(100),e.close(),fe.Z.messageBox("发布成功","success"),await this.getCspInfo(),this.createCspVisible=!1})).catch((async()=>{await fe.Z.delay(100),e.close(),fe.Z.messageBox("发布失败","error")}))},async deleteCspInfo(e){let l=fe.Z.loadingWait("删除中...");await fe.Z.delay(100),(0,he.Z)({url:`teacher/publish/delete/${e}`,method:"POST",headers:{"content-type":"application/json;charset=UTF-8"}}).then((async e=>{await fe.Z.delay(100),l.close(),403===e.data.code?fe.Z.messageBox(e.data.msg,"warning"):(fe.Z.messageBox("删除成功","success"),await this.getCspInfo())})).catch((async()=>{await fe.Z.delay(100),l.close(),fe.Z.messageBox("删除失败","error")}))},async editCsp(){if(""===this.editCspInfo.endTime||""===this.editCspInfo.startTime||""===this.editCspInfo.number||""===this.editCspInfo.gtScore)return void fe.Z.messageBox("请将信息填写完整","warning");let e=fe.Z.loadingWait("修改中...");await fe.Z.delay(100),(0,he.Z)({method:"POST",url:"teacher/publish/modify",headers:{"content-type":"application/json"},data:{id:this.editCspInfo.id,name:this.editCspInfo.number,startTime:fe.Z.timeStampToTime(new Date(this.editCspInfo.startTime).getTime()),endTime:fe.Z.timeStampToTime(new Date(this.editCspInfo.endTime).getTime()),freeThreshold:this.editCspInfo.gtScore}}).then((async()=>{await fe.Z.delay(100),e.close(),fe.Z.messageBox("修改成功","success"),await this.getCspInfo(),this.editCspVisible=!1})).catch((async()=>{await fe.Z.delay(100),e.close(),fe.Z.messageBox("修改失败","error")}))},editCspOpen(e){this.editCspInfo.id=this.cspInfoList[e].id,this.editCspInfo.endTime=this.cspInfoList[e].endTime,this.editCspInfo.startTime=this.cspInfoList[e].startTime,this.editCspInfo.gtScore=this.cspInfoList[e].freeThreshold,this.editCspInfo.number=this.cspInfoList[e].name,this.editCspVisible=!0},editCspClose(){this.editCspInfo.endTime="",this.editCspInfo.startTime="",this.editCspInfo.number="",this.editCspInfo.gtScore=""},createCspClose(){this.createCspInfo.endTime="",this.createCspInfo.startTime="",this.createCspInfo.number="",this.createCspInfo.gtScore=""},getProcessionStr(e,l){let s=this.getProcessionNum(e,l);return s<0?"未开始":s>100?"已结束":"报名中"},getProcession(e,l){let s=this.getProcessionNum(e,l);return s<0?0:s>100?100:s},getProcessionNum(e,l){let s=new Date(e).valueOf(),t=new Date(l).valueOf(),a=(new Date).valueOf(),o=(a-s)/(t-s),i=100*Number(o).toFixed(2);return Number(i)>=100?101:Number(i)<0?-1:Math.ceil(Number(i))},async uploadEnrollInfo(e){if(0===this.userInfo.freeOrOwn&&1===this.enrollInfo.freeOrOwn)return void fe.Z.messageBox("您的免费次数不足只能选择自费");let l=fe.Z.loadingWait("报名中...");await fe.Z.delay(50),await(0,he.Z)({method:"POST",url:"pre/reg",headers:{"content-type":"application/json;charset=UTF-8"},data:{cspId:e,type:this.enrollInfo.freeOrOwn,extra:this.enrollInfo.extra}}).then((async e=>{await fe.Z.delay(100),l.close(),403===e.data.code?fe.Z.messageBox(e.data.msg,"warning"):(fe.Z.messageBox("报名成功","success"),this.enrollInfo.extra="",this.enrollInfo.freeOrOwn="",this.enrollVisible=!1,await this.getCspInfo()),this.enrollInfo.extra="",this.enrollInfo.freeOrOwn=""})).catch((async e=>{await fe.Z.delay(100),l.close(),fe.Z.messageBox(e.data.msg,"error")}))},async getCspInfo(){let e=fe.Z.loadingWait("拉取CSP信息中...");await fe.Z.delay(200),await this.$axios.get("csp_info/pre").then((async l=>{await fe.Z.delay(100),e.close(),fe.Z.messageBox("CSP信息拉取成功","success"),this.cspInfoList=l.data.data})).catch((async()=>{await fe.Z.delay(100),e.close(),fe.Z.messageBox("拉取CSP信息失败","error")}))},enroll(e){this.enrollVisible=!0,this.currentCspInfo=this.cspInfoList[e]},enrollCancel(){this.enrollInfo.extra="",this.enrollInfo.freeOrOwn=""},async deleteEnroll(e){let l=fe.Z.loadingWait("取消报名中。。。");await fe.Z.delay(50),(0,he.Z)({method:"POST",headers:{"content-type":"application/x-www-form-urlencoded;charset=UTF-8"},url:`pre/reg/cancel/${e}`}).then((async e=>{await fe.Z.delay(100),l.close(),403===e.data.code?fe.Z.messageBox("您没有报名，请勿随意操作","warning"):(fe.Z.messageBox("取消报名成功","success"),await this.getCspInfo())})).catch((async()=>{await fe.Z.delay(100),l.close(),fe.Z.messageBox("取消报名失败","error")}))}}},be=s(3744);const we=(0,be.Z)(Ce,[["render",me],["__scopeId","data-v-49619937"]]);var ge=we}}]);
//# sourceMappingURL=305.fba708b2.js.map