"use strict";(self["webpackChunkvue"]=self["webpackChunkvue"]||[]).push([[884],{884:function(e,a,t){t.r(a),t.d(a,{default:function(){return A}});var l=t(6252),s=t(9963),o=t(3577);const n=e=>((0,l.dD)("data-v-2f4d92b8"),e=e(),(0,l.Cn)(),e),i={class:"wrapper"},d={class:"content-page"},r={class:"content"},c={class:"container-fluid"},p=(0,l.uE)('<div class="row" data-v-2f4d92b8><div class="col-12" data-v-2f4d92b8><div class="page-title-box" data-v-2f4d92b8><div class="page-title-right" data-v-2f4d92b8><ol class="breadcrumb m-0" data-v-2f4d92b8></ol></div><h4 class="page-title" data-v-2f4d92b8>学生报名信息管理</h4></div></div></div>',1),u={class:"row"},m={class:"col-12"},g={class:"card"},h={class:"card-body"},f={style:{"margin-bottom":"10px"}},b={style:{"margin-bottom":"0!important",display:"inline-block","justify-content":"center","align-items":"center"}},w=n((()=>(0,l._)("span",{style:{"margin-right":"5px!important"}}," 届数选择 ",-1))),y={style:{"margin-bottom":"10px"}},v={style:{"margin-top":"0!important",display:"inline-block","justify-content":"center","align-items":"center"}},C={class:"row mb-2"},I={class:"col-sm-5"},S=n((()=>(0,l._)("span",{class:"btn btn-danger mb-2"},[(0,l._)("i",{class:"mdi mdi-plus-circle me-2"}),(0,l.Uk)(" 未正式报名表")],-1))),Z=n((()=>(0,l._)("label",{class:"form-label"},"姓名",-1))),_=n((()=>(0,l._)("label",{class:"form-label"},"学号",-1))),x=n((()=>(0,l._)("label",{class:"form-label"},"年级",-1))),k=n((()=>(0,l._)("label",{class:"form-label"},"身份证号",-1))),W={class:"dialog-footer"},V={class:"dialog-footer"},L={style:{float:"right"}},N={style:{float:"right"}};function T(e,a,t,n,T,U){const z=(0,l.up)("TopNav"),B=(0,l.up)("LeftNav"),j=(0,l.up)("el-option"),E=(0,l.up)("el-select"),P=(0,l.up)("el-button"),D=(0,l.up)("el-upload"),F=(0,l.up)("el-input"),A=(0,l.up)("el-dialog"),O=(0,l.up)("el-table-column"),$=(0,l.up)("el-table"),M=(0,l.up)("el-pagination"),G=(0,l.Q2)("loading");return(0,l.wg)(),(0,l.iD)("body",null,[(0,l._)("div",i,[(0,l.Wm)(z),(0,l.Wm)(B),(0,l._)("div",d,[(0,l._)("div",r,[(0,l._)("div",c,[p,(0,l._)("div",u,[(0,l._)("div",m,[(0,l._)("div",g,[(0,l._)("div",h,[(0,l._)("div",f,[(0,l._)("span",b,[w,(0,l.Wm)(E,{clearable:"",modelValue:T.nowCspSelect,"onUpdate:modelValue":a[0]||(a[0]=e=>T.nowCspSelect=e),class:"m-2",placeholder:"选择导入的CSP届数",style:{"margin-bottom":"0!important","margin-top":"0!important","margin-left":"0!important",display:"inline-block"}},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(T.cspNameSelectList,(e=>((0,l.wg)(),(0,l.j4)(j,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])]),(0,l._)("div",y,[(0,l._)("span",v,[(0,l.Wm)(D,{ref:"upload",style:{display:"inline-block","margin-right":"20px"},action:"##","auto-upload":!1,"show-file-list":!1,"on-change":U.handleExcel},{default:(0,l.w5)((()=>[(0,l.Wm)(P,{type:"primary",size:"small"},{default:(0,l.w5)((()=>[(0,l.Uk)("导入正式报名表")])),_:1})])),_:1},8,["on-change"]),(0,l.Wm)(D,{ref:"uploadScore",style:{display:"inline-block","margin-right":"20px"},action:"##","auto-upload":!1,"show-file-list":!1,"on-change":U.handleScoreExcel},{default:(0,l.w5)((()=>[(0,l.Wm)(P,{type:"primary",size:"small"},{default:(0,l.w5)((()=>[(0,l.Uk)("成绩单上传")])),_:1})])),_:1},8,["on-change"]),(0,l.Wm)(P,{type:"primary",onClick:a[1]||(a[1]=e=>U.getAbsenceTable(1,5)),size:"small"},{default:(0,l.w5)((()=>[(0,l.Uk)("查看未正式报名学生")])),_:1}),(0,l.Wm)(P,{onClick:U.sendMessageToAllAbsence,type:"primary",size:"small"},{default:(0,l.w5)((()=>[(0,l.Uk)("提醒学生参与正式报名")])),_:1},8,["onClick"])])]),(0,l._)("div",C,[(0,l._)("div",I,[S,(0,l.Wm)(A,{modelValue:T.addInfoDialogVisible,"onUpdate:modelValue":a[10]||(a[10]=e=>T.addInfoDialogVisible=e),title:"学生信息添加",width:"30%",onClose:e.addInputInfoClose},{footer:(0,l.w5)((()=>[(0,l._)("span",W,[(0,l.Wm)(P,{onClick:a[6]||(a[6]=e=>T.addInfoDialogVisible=!1)},{default:(0,l.w5)((()=>[(0,l.Uk)("关闭")])),_:1}),(0,l.Wm)(P,{type:"primary",onClick:e.addInput},{default:(0,l.w5)((()=>[(0,l.Uk)(" 确认 ")])),_:1},8,["onClick"]),(0,l.wy)((0,l.Wm)(P,{text:"",onClick:a[7]||(a[7]=e=>T.addInfoConfirmVisible=!0)},{default:(0,l.w5)((()=>[(0,l.Uk)(" Click to open the Dialog ")])),_:1},512),[[s.F8,!1]]),(0,l.Wm)(A,{modelValue:T.addInfoConfirmVisible,"onUpdate:modelValue":a[9]||(a[9]=e=>T.addInfoConfirmVisible=e),title:"Warning",width:"30%",center:""},{footer:(0,l.w5)((()=>[(0,l._)("span",V,[(0,l.Wm)(P,{onClick:a[8]||(a[8]=e=>T.addInfoConfirmVisible=!1)},{default:(0,l.w5)((()=>[(0,l.Uk)("取消")])),_:1}),(0,l.Wm)(P,{type:"primary",onClick:e.addInfoConfirm},{default:(0,l.w5)((()=>[(0,l.Uk)(" 确认 ")])),_:1},8,["onClick"])])])),default:(0,l.w5)((()=>[(0,l._)("span",null,(0,o.zw)(T.confirmMessage),1)])),_:1},8,["modelValue"])])])),default:(0,l.w5)((()=>[(0,l._)("div",null,[Z,(0,l.Wm)(F,{style:{"margin-bottom":"10px"},modelValue:T.addInputInfo.name,"onUpdate:modelValue":a[2]||(a[2]=e=>T.addInputInfo.name=e),placeholder:"输入姓名"},null,8,["modelValue"]),_,(0,l.Wm)(F,{style:{"margin-bottom":"10px"},modelValue:T.addInputInfo.studentNum,"onUpdate:modelValue":a[3]||(a[3]=e=>T.addInputInfo.studentNum=e),placeholder:"输入学号"},null,8,["modelValue"]),x,(0,l.Wm)(F,{style:{"margin-bottom":"10px"},modelValue:T.addInputInfo.grade,"onUpdate:modelValue":a[4]||(a[4]=e=>T.addInputInfo.grade=e),placeholder:"输入年级如：2020"},null,8,["modelValue"]),k,(0,l.Wm)(F,{style:{"margin-bottom":"10px"},modelValue:T.addInputInfo.studentId,"onUpdate:modelValue":a[5]||(a[5]=e=>T.addInputInfo.studentId=e),placeholder:"身份证号（18位）"},null,8,["modelValue"])])])),_:1},8,["modelValue","onClose"])]),(0,l.wy)(((0,l.wg)(),(0,l.j4)($,{fit:"",stripe:"true",id:"table_studentList",border:"",ref:"multipleTableRef",data:T.absenceTableList,style:{width:"100%"},onSelectionChange:U.handleSelectionChange},{default:(0,l.w5)((()=>[(0,l.Wm)(O,{type:"selection",width:"55px"}),(0,l.Wm)(O,{property:"studentNumber",label:"学号",width:"200px","show-overflow-tooltip":""}),(0,l.Wm)(O,{property:"name",label:"姓名",width:"150px","show-overflow-tooltip":""}),(0,l.Wm)(O,{property:"grade",label:"年级",width:"80px","show-overflow-tooltip":""}),(0,l.Wm)(O,{property:"maxScore",label:"最高分",width:"80px","show-overflow-tooltip":""}),(0,l.Wm)(O,{property:"freeTime",label:"免费次数","show-overflow-tooltip":""})])),_:1},8,["data","onSelectionChange"])),[[G,T.tableLoading]]),(0,l._)("div",L,[(0,l._)("div",N,[(0,l.Wm)(M,{style:{"margin-top":"20px"},"current-page":T.currentPage,"onUpdate:current-page":a[11]||(a[11]=e=>T.currentPage=e),"page-size":T.pageSize,"onUpdate:page-size":a[12]||(a[12]=e=>T.pageSize=e),"page-sizes":[5,10,15,20],small:e.small,disabled:e.disabled,background:e.background,layout:"total, sizes, prev, pager, next, jumper,",total:T.absenceTotalNum,onSizeChange:U.handleSizeChange,onCurrentChange:U.handleCurrentChange},null,8,["current-page","page-size","small","disabled","background","total","onSizeChange","onCurrentChange"])])])])])])])])])])])])])}t(7658);var U=t(9308),z=t(6317),B=t(5781),j=t(6133),E=t(594),P={name:"studentList.vue",components:{TopNav:U.Z,LeftNav:z.Z},data(){return{Search:B.olm,Delete:B.HG3,Edit:B.I8b,searchInfo:{nameOrStudentNumber:"",grade:"",freeTime:"",scoreFilter:"",score:""},addInfoConfirmVisible:!1,addInfoDialogVisible:!1,confirmMessage:"",addInputInfo:{studentNum:"",studentId:"",name:"",grade:""},isConfirm:!1,confirmType:1,currentPage:1,pageSize:5,tableLoading:!1,selection:[],cspInfoList:[],cspNameSelectList:[],nowCspSelect:"",absenceTableList:[],absenceTotalNum:0}},methods:{handleSelectionChange(e){this.selection=e},async handleSizeChange(e){this.pageSize=e,await this.getAbsenceTable(this.currentPage,e)},async handleCurrentChange(e){this.currentPage=e,await this.absenceTableList(e,this.pageSize)},async handleExcel(e){if(""===this.nowCspSelect)return void j.Z.messageBox("请先选择届次","warning");let a=t(4105),l=e.raw;if(!l)return;let s=j.Z.loadingWait("解析表格中......");await j.Z.delay(100);let o=await j.Z.readFile(l),n=a.read(o,{type:"binary"}),i=n.Sheets[n.SheetNames[0]],d=a.utils.sheet_to_json(i,{range:2}),r=Object.keys(d[0]),c=0,p=0,u=0;for(let t=0;t<r.length;t++)"学号"===r[t]?c=t:"团报单位"===r[t]?p=t:"报名状态"===r[t]&&(u=t);let m=[];for(let t=0;t<d.length;t++){let e=Object.values(d[t]);if("未提交报名"!==e[u]){let a=e[p],t=0;t="南京理工大学"===a?1:0,m.push({studentIdNumber:e[c].toString(),cspId:this.cspNameSelectList[this.nowCspSelect].cspId,type:t})}}await j.Z.delay(100),s.close(),j.Z.messageBox("解析成功","success"),this.$refs.upload.clearFiles(),await this.uploadExcelInfo(m)},async handleScoreExcel(e){if(""===this.nowCspSelect)return void j.Z.messageBox("请先选择届次","warning");let a=t(4105),l=e.raw;if(!l)return;let s=j.Z.loadingWait("解析表格中......");await j.Z.delay(100);let o=await j.Z.readFile(l),n=a.read(o,{type:"binary"}),i=n.Sheets[n.SheetNames[0]],d=a.utils.sheet_to_json(i,{range:2}),r=[],c=Object.keys(d[0]),p=0,u=0;for(let t=0;t<c.length;t++)"学号"===c[t]?p=t:"认证总分"===c[t]&&(u=t);for(let t=0;t<d.length;t++){let e=Object.values(d[t]);r.push({studentIdNumber:e[p].toString(),cspId:this.cspNameSelectList[this.nowCspSelect].cspId,score:e[u]})}await j.Z.delay(100),s.close(),j.Z.messageBox("解析成功","success"),this.$refs.uploadScore.clearFiles(),await this.uploadScoreExcelInfo(r)},async uploadScoreExcelInfo(e){let a=j.Z.loadingWait("上传中。。。","table_studentList");await j.Z.delay(100),await(0,E.Z)({method:"POST",headers:{"content-type":"application/json"},url:"teacher/upload/transcripts",data:e}).then((async e=>{await j.Z.delay(100),a.close(),j.Z.messageBox("上传成功","success")})).catch((async e=>{await j.Z.delay(100),a.close(),j.Z.messageBox("成绩更新失败","error")}))},async uploadExcelInfo(e){let a=j.Z.loadingWait("上传信息中。。。");await j.Z.delay(50);let t=1;return await(0,E.Z)({headers:{"content-type":"application/json"},method:"post",url:"teacher/upload/regList",data:e}).catch((()=>{t=0})),await j.Z.delay(100),a.close(),0===t?(j.Z.messageBox("上传正式报名表格失败","error"),0):(j.Z.messageBox("上传正式报名表格成功","success"),1)},async sendMessageToAllAbsence(){if(""===this.nowCspSelect)return void j.Z.messageBox("请先选择届次","warning");let e=j.Z.loadingWait("发送中");await j.Z.delay(100),await(0,E.Z)({method:"POST",headers:{"content-type":"application/x-www-form-urlencoded;charset=UTF-8"},url:`teacher/notice/official/${this.cspNameSelectList[this.nowCspSelect].cspId}/`}).then((async a=>{e.close(),await j.Z.delay(100),j.Z.messageBox("发送成功","success")})).catch((async a=>{e.close(),await j.Z.delay(100),j.Z.messageBox("发送失败","error")}))},async getAbsenceTable(e,a){if(""===this.nowCspSelect)return void j.Z.messageBox("请先选择届次","warning");let t=j.Z.loadingWait("获取中","table_studentList");await j.Z.delay(100),(0,E.Z)({method:"GET",headers:{"content-type":"application/x-www-form-urlencoded;charset=UTF-8"},url:`teacher/query/absent/official/${this.cspNameSelectList[this.nowCspSelect].cspId}/${e}/${a}`}).then((async e=>{t.close(),await j.Z.delay(100),j.Z.messageBox("查询成功","success"),e.data.data.length>0&&(this.absenceTableList=e.data.data,this.absenceTotalNum=e.data.data[0].totalSize)})).catch((async()=>{t.close(),await j.Z.delay(100),j.Z.messageBox("查询失败","error")}))},async getCspInfo(){let e=j.Z.loadingWait("拉取CSP届次中。。。");await j.Z.delay(200),await this.$axios.get("csp_info/pre").then((async a=>{if(await j.Z.delay(100),e.close(),j.Z.messageBox("CSP届次拉取成功","success"),a.data.data.length>0){for(let e=0;e<a.data.data.length;e++)this.cspNameSelectList.push({value:e,label:a.data.data[e].name,cspId:a.data.data[e].id});this.cspInfoList=a.data.data}})).catch((async()=>{await j.Z.delay(100),e.close(),j.Z.messageBox("拉取CSP届次失败","error")}))}},created(){this.getCspInfo()},mounted(){window.addEventListener("beforeunload",(e=>j.Z.destroyCookie(e)))},unmounted(){window.removeEventListener("beforeunload",(e=>j.Z.destroyCookie(e)))}},D=t(3744);const F=(0,D.Z)(P,[["render",T],["__scopeId","data-v-2f4d92b8"]]);var A=F}}]);
//# sourceMappingURL=884.652cd754.js.map